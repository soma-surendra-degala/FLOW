<div class="flex">
  <!-- Sidebar -->
  <app-sidebar [isOpen]="isSidebarOpen" (toggle)="toggleSidebar()"></app-sidebar>

  <!-- Main Content -->
  <div class="flex-1 p-6">
    <h2 class="text-2xl font-bold mb-4">Support Tickets</h2>

    <table class="table-auto w-full border">
      <thead>
        <tr class="bg-gray-200">
          <th class="px-4 py-2">Student</th>
          <th class="px-4 py-2">Subject</th>
          <th class="px-4 py-2">Message</th>
          <th class="px-4 py-2">Status</th>
          <th class="px-4 py-2">Replies</th>
          <th class="px-4 py-2">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ticket of tickets" class="border-b">
          <td class="px-4 py-2">
            {{ getStudentName(ticket) }}
          </td>
          <td class="px-4 py-2">{{ ticket.subject }}</td>
          <td class="px-4 py-2">{{ ticket.message }}</td>
          <td class="px-4 py-2">
            <select 
              [ngModel]="ticket.status" 
              (ngModelChange)="updateStatus(ticket._id!, $event)"
              class="border rounded px-2 py-1"
            >
              <option value="open">Open</option>
              <option value="in-progress">In Progress</option>
              <option value="closed">Closed</option>
            </select>
          </td>
          <div *ngFor="let ticket of tickets" class="mb-4 p-4 rounded-xl border border-neutral-700 dark:border-gray-300">
  <h3 class="font-semibold">{{ ticket.subject }}</h3>
  <p class="text-gray-400 dark:text-gray-700">{{ ticket.message }}</p>
  <p class="mt-2"><strong>Status:</strong> 
    <span [ngClass]="{
      'text-yellow-400': ticket.status === 'open',
      'text-blue-400': ticket.status === 'in-progress',
      'text-green-400': ticket.status === 'closed'
    }">{{ ticket.status }}</span>
  </p>

  <!-- Replies -->
  <div *ngIf="ticket.replies?.length > 0" class="mt-3">
    <h4 class="font-semibold text-cyan-400">Replies:</h4>
    <div *ngFor="let reply of ticket.replies" class="mt-1 text-sm">
      <p>
        <strong>{{ reply.sender }}:</strong> {{ reply.message }}
        <i class="text-gray-400">({{ reply.createdAt | date:'short' }})</i>
      </p>
    </div>
  </div>

  <!-- Reply box -->
  <div class="mt-3 flex">
    <input type="text"
           [(ngModel)]="replyMessage"
           placeholder="Type your reply..."
           class="flex-1 px-3 py-2 rounded-lg border border-neutral-700 text-neutral-800 dark:text-neutral-700 focus:ring-2 focus:ring-cyan-500"/>
    <button (click)="sendReply(ticket._id!)"
            class="ml-2 px-4 py-2 rounded-lg bg-cyan-500 hover:bg-cyan-600 text-white font-medium">
      Send
    </button>
  </div>
</div>

          <td class="px-4 py-2">
            <button 
              (click)="deleteTicket(ticket._id!)" 
              class="bg-red-500 text-white px-3 py-1 rounded"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
